---
title: "Soil depth prediction: comparison of statistical approaches"
author: "Taciara Zborowski Horst; Ricardo Simão Diniz Dalmolin; Jean Michel Moura-Bueno; Alessandro Samuel-Rosa"
date: "15 de janeiro de 2018"
output: bookdown::html_document2
lang: pt
---

```{r, echo=FALSE, eval=FALSE}
rmarkdown::render('code.Rmd', encoding = 'UTF-8', output_dir = "../docs")
```

```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE, warning=FALSE}
library(magrittr)
library(dplyr)
library(glue)
library(lattice)
library(latticeExtra)
library(georob)
library(sp)
library(mapview)
library(raster)
library(rmarkdown)
library(caret)
library(randomForest)
```

Based on the relationship between soil depth and topography, the objective of this study was to investigate how much the choice of the statistical method could improve the spatial prediction of soil depth. For this, we compared the performance of cross validation of multiple linear regression and random forest and formulations of three models, soil depth as a function of: i) geographic coordinates; (ii) topographic covariates; and (iii) covariables, topographies and geographic coordinates. For that, we use 102 observations of soil depth from an area of 109 ha of pinus at 29 years, in the city of Campo Belo do Sul, mountain region of the State of Santa Catarina, Brazil. The topograpy variables used in the models are derived from a DEM of 10 m resolution, namely, elevation, slope, LS factor, terrain ruggedness index, topographic wetness index, total insolation, analytical hillshading, aspect, catchment area, channel network base level, valley depth, cross-sectional curvature, vertical distance to channel network, total insolation, relative slope position, general curvature and profile curvature. To select the appropriate combination of statistical methods and model formulation we used the coefficient of determination (R^2^) and root mean square error (RMSE) to assess the performances. Soil depth was predicted for the whole area using the best model. Overall, there were slight variations in predictive performance differences between statistical approaches and model formulations. In our case study, the random forest model was the best method and spatially explicit models had values R2 higher and RMSE lower than non-spatial models Results show that the prediction accuracy did not improve using topograpy covariates, due to lack of correlation. The reason why the improvement of the prediction was not more significant is a low correlation of the predicted soil depth with used covariates. Since alternative, other prediction methods of the kriging and different resolutions will be tested.

**Keywords:** Digital soil mapping; soil properties; soil tickness; enviroment covarieres.

**Financial Support:** Coordenação de Aperfeiçoamento de Pessoal de Nível Superior (CAPES).

```{r, include=FALSE}
rm(list = ls())
pontos <- read.csv('../data/GateadosDados.csv', dec = ".", sep= ";", stringsAsFactors = FALSE)
pontos$PFd <- pontos$PF / 10 %>% round()
pontos$coordX <- pontos$X
pontos$coordY <- pontos$Y
sp::coordinates(pontos) <- c('coordX' , 'coordY')
wgs84utm22s <- sp::CRS('+proj=utm +zone=22 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs')
sp::proj4string(pontos) <- wgs84utm22s
```

```{r, include=FALSE}
summary(pontos$PFd)
```

```{r fig.asp=1, include=FALSE}
histogram(pontos$PFd) + latticeExtra::layer(panel.grid(v = 0)) + latticeExtra::layer(panel.rug(pontos$PFd))
```

```{r, message=FALSE, include=FALSE}
DECLI <- raster::raster("../data/Covars/DECLI.tif")
ELEV <- raster::raster("../data/Covars/ELEV.tif")
VD <- raster::raster("../data/Covars/VD.tif")
TWI <- raster::raster("../data/Covars/TWI.tif")
CNBL <- raster::raster("../data/Covars/CNBL.tif")
AH <- raster::raster("../data/Covars/AH.tif")
ASP <- raster::raster("../data/Covars/ASP.tif")
CA <- raster::raster("../data/Covars/CA.tif")
CSC <- raster::raster("../data/Covars/CSC.tif")
LS <- raster::raster("../data/Covars/LS.tif")
PLC <- raster::raster("../data/Covars/PLC.tif")
VDCN <- raster::raster("../data/Covars/VDCN.tif")
RSP <- raster::raster("../data/Covars/RSP.tif")
TRI <- raster::raster("../data/Covars/TRI.tif")
TI <- raster::raster("../data/Covars/TI.tif")
GC <- raster::raster("../data/Covars/GC.tif")
```

```{r, include=FALSE}
pontos$DECLI <- raster::extract(DECLI, pontos)
pontos$ELEV <- raster::extract(ELEV, pontos)
pontos$VD <- raster::extract(VD, pontos)
pontos$TWI <- raster::extract(TWI, pontos)
pontos$CNBL <- raster::extract(CNBL, pontos)
pontos$AH <- raster::extract(AH, pontos)
pontos$ASP <- raster::extract(ASP, pontos)
pontos$CA <- raster::extract(CA, pontos)
pontos$CSC <- raster::extract(CSC, pontos)
pontos$LS <- raster::extract(LS, pontos)
pontos$PLC <- raster::extract(PLC, pontos)
pontos$VDCN <- raster::extract(VDCN, pontos)
pontos$RSP <- raster::extract(RSP, pontos)
pontos$TRI <- raster::extract(TRI, pontos)
pontos$TI <- raster::extract(TI, pontos)
pontos$GC <- raster::extract(GC, pontos)
```

```{r,include=FALSE}
form1 <- PFd ~ X + Y
form2 <- formula(paste("PFd", " ~ ", paste(colnames(pontos@data[,9:24]), collapse = " + ")))
form3 <- PFd ~ DECLI + ELEV + VD + TWI + CNBL + AH + ASP + CA + CSC + 
    LS + PLC + VDCN + RSP + TRI + TI + GC + X + Y
```

```{r, include=FALSE}
#RANDOM FOREST
rf_fit1 <- caret::train(form1, data = pontos@data,
                       method = "rf", tuneLength = 1, importance = TRUE, trControl = trainControl("LOOCV"))
rf_fit1
```

```{r, include=FALSE}
rf_fit2 <- caret::train(form2, data = pontos@data,
                       method = "rf", tuneLength = 1, importance = TRUE, trControl = trainControl("LOOCV"))
rf_fit2
```

```{r,include=FALSE}
rf_fit3 <- caret::train(form3, data = pontos@data,
                       method = "rf", tuneLength = 1, importance = TRUE, trControl = trainControl("LOOCV"))
rf_fit3
```

```{r, include=FALSE}
#LINEAR REGRESSION
lm_fit1 <- train(
  form = form1, data = pontos@data, method = "lmStepAIC", tuneLength = 1, importance = TRUE,
  na.action = na.omit, trControl = trainControl(method = "LOOCV"))

lm_fit1
```

```{r, include=FALSE}
lm_fit2 <- train(
  form = form2, data = pontos@data, method = "lmStepAIC", tuneLength = 1, importance = TRUE,
  na.action = na.omit, trControl = trainControl(method = "LOOCV"))

lm_fit2
```

```{r, include=FALSE}
lm_fit3 <- train(
  form = form3, data = pontos@data, method = "lmStepAIC", tuneLength = 1, importance = TRUE,
  na.action = na.omit, trControl = trainControl(method = "LOOCV"))

lm_fit3
```
